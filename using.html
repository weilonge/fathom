

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using Fathom &mdash; Fathom 2.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/tweaks.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Fathom 2.0 documentation" href="index.html"/>
        <link rel="next" title="Rule and Ruleset Reference" href="ruleset.html"/>
        <link rel="prev" title="Introduction" href="intro.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Fathom
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using Fathom</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#where-it-works">Where It Works</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-language">The Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rules-sides-and-flows">Rules, Sides, and Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pulling-out-answers">Pulling Out Answers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ruleset.html">Rule and Ruleset Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="utilities.html">Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="versions.html">Version History</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Fathom</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 







<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Using Fathom</li>
    <li class="wy-breadcrumbs-aside">
      
          
          <a href="_sources/using.rst.txt" rel="nofollow"> View page source</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-fathom">
<h1>Using Fathom<a class="headerlink" href="#using-fathom" title="Permalink to this headline">¶</a></h1>
<div class="section" id="where-it-works">
<h2>Where It Works<a class="headerlink" href="#where-it-works" title="Permalink to this headline">¶</a></h2>
<p>Fathom works against the DOM API, so you can use it server-side with <code class="docutils literal"><span class="pre">jsdom</span></code> (which the test harness uses) or another implementation, or you can embed it in a browser and pass it a native DOM. Experimentally, you can also pass in a subtree of a DOM.</p>
<p>Kate Hudson has put together <a class="reference external" href="https://github.com/k88hudson/ffmetadata">a Firefox add-on that lets you see the results of Fathom 1.0 rulesets against the currently loaded page</a>, as a new pane of the Developer Tools.</p>
<p>Michael Comella <a class="reference external" href="https://github.com/mcomella/fathom-android-experiments">got Fathom 1.0 running on Android</a>, returning results to Java via a WebView.</p>
</div>
<div class="section" id="the-language">
<h2>The Language<a class="headerlink" href="#the-language" title="Permalink to this headline">¶</a></h2>
<p>Think of Fathom as a tiny programming language that recognizes the significant parts of DOM trees by means of its programs, Fathom rulesets. A ruleset is an unordered bag of rules, each of which takes in DOM nodes and annotates them with scores, types, and notes to influence future rules. At the end of the chain of rules, out pops one or more pieces of output—typically high-scoring nodes of certain types—to inform the surrounding imperative program.</p>
<p>This simple ruleset finds DOM nodes that could contain a useful page title and scores them according to how likely that is:</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">rules</span> <span class="o">=</span> <span class="nx">ruleset</span><span class="p">(</span>
    <span class="c1">// Give any title tag the (default) score of 1, and tag it as title-ish:</span>
    <span class="nx">rule</span><span class="p">(</span><span class="nx">dom</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span> <span class="nx">type</span><span class="p">(</span><span class="s1">&#39;titley&#39;</span><span class="p">)),</span>

    <span class="c1">// Give any OpenGraph meta tag a score of 2, and tag it as title-ish as well:</span>
    <span class="nx">rule</span><span class="p">(</span><span class="nx">dom</span><span class="p">(</span><span class="s1">&#39;meta[property=&quot;og:title&quot;]&#39;</span><span class="p">),</span> <span class="nx">type</span><span class="p">(</span><span class="s1">&#39;titley&#39;</span><span class="p">).</span><span class="nx">score</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>

    <span class="c1">// Take all title-ish things, and punish them if they contain</span>
    <span class="c1">// navigational claptrap like colons or dashes:</span>
    <span class="nx">rule</span><span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="s1">&#39;titley&#39;</span><span class="p">),</span> <span class="nx">score</span><span class="p">(</span><span class="nx">fnode</span> <span class="p">=&gt;</span> <span class="nx">containsColonsOrDashes</span><span class="p">(</span><span class="nx">fnode</span><span class="p">.</span><span class="nx">element</span><span class="p">)</span> <span class="o">?</span> <span class="mf">.5</span> <span class="o">:</span> <span class="mi">1</span><span class="p">)),</span>

    <span class="c1">// Offer the max-scoring title-ish node under the output key &quot;title&quot;:</span>
    <span class="nx">rule</span><span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="s1">&#39;titley&#39;</span><span class="p">).</span><span class="nx">max</span><span class="p">(),</span> <span class="nx">out</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">))</span>
<span class="p">);</span>
</pre></div>
</div>
<p>See below for a full definition of <cite>type</cite>, <cite>score</cite>, and the rest of the Fathom language.</p>
</div>
<div class="section" id="rules-sides-and-flows">
<h2>Rules, Sides, and Flows<a class="headerlink" href="#rules-sides-and-flows" title="Permalink to this headline">¶</a></h2>
<p>Each rule is shaped like <code class="docutils literal"><span class="pre">rule(left-hand</span> <span class="pre">side,</span> <span class="pre">right-hand</span> <span class="pre">side)</span></code>. The <em>left-hand side</em> (LHS) pulls in one or more DOM nodes as input: either ones that match a certain CSS selector (<a class="reference internal" href="ruleset.html#dom" title="dom"><code class="xref js js-func docutils literal"><span class="pre">dom()</span></code></a>) or ones tagged with a certain type by other rules (<a class="reference internal" href="ruleset.html#type" title="type"><code class="xref js js-func docutils literal"><span class="pre">type()</span></code></a>). The <em>right-hand side</em> (RHS) then decides what to do with those nodes: assigning an additional type, scaling the score, scribbling a note on it, or some combination thereof. Envision the rule as a pipeline, with the DOM flowing in one end, nodes being picked and passed along to RHSs which twiddle them, and then finally falling out right side, where they might flow into other rules whose LHSs pick them up.</p>
<p>It&#8217;s snakey sort of flow. This rule, which takes in fnodes that have previously been identified as text containers and adds a word-count annotation...</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">rule</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;textContainer&#39;</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;countedWords&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">note</span><span class="p">(</span><span class="n">fnode</span> <span class="o">=&gt;</span> <span class="n">fnode</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">textContent</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="o">/</span>\<span class="n">s</span><span class="o">+/</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">))</span>
</pre></div>
</div>
<p>...can be thought of as...</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>textContainer fnodes emitted        assign &quot;countedWords&quot; type
     from other rules          -&gt;        and a word count        -&gt;   changed nodes --\
                                                                                      |
 ____________________________________________________________________________________ /
/
|
\-&gt;  other rules&#39; LHSs         -&gt;   ...                          -&gt;   ...          --&gt;  ...
</pre></div>
</div>
<p>Remember that Fathom&#8217;s rulesets are unordered, so any rule&#8217;s output can flow into any other rule, not just ones that happen to come lexically after it.</p>
</div>
<div class="section" id="pulling-out-answers">
<h2>Pulling Out Answers<a class="headerlink" href="#pulling-out-answers" title="Permalink to this headline">¶</a></h2>
<p>Once the ruleset is defined, run a DOM tree through it:</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">dom</span> <span class="o">=</span> <span class="nx">jsdom</span><span class="p">.</span><span class="nx">jsdom</span><span class="p">(</span><span class="s2">&quot;&lt;html&gt;&lt;head&gt;...&lt;/html&gt;&quot;</span><span class="p">));</span>
<span class="c1">// Tell the ruleset which DOM to run against, yielding a factbase about the document:</span>
<span class="kr">const</span> <span class="nx">facts</span> <span class="o">=</span> <span class="nx">rules</span><span class="p">.</span><span class="nx">against</span><span class="p">(</span><span class="nx">dom</span><span class="p">);</span>
</pre></div>
</div>
<p>After running a tree or subtree through, pull the answers out of the factbase: in this case, we want the max-scoring title, which the ruleset conveniently stores under the &#8220;title&#8221; output key:</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">bestTitle</span> <span class="o">=</span> <span class="nx">facts</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>If the ruleset doesn&#8217;t anticipate the output you want, you can ask for it more explicitly by passing a full LHS to <a class="reference internal" href="ruleset.html#BoundRuleset.get" title="BoundRuleset.get"><code class="xref js js-func docutils literal"><span class="pre">get()</span></code></a>. For example, if you simply want all the title-ish things so you can do further computation on them...</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">allTitles</span> <span class="o">=</span> <span class="nx">facts</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="s1">&#39;titley&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>Or if you have a reference to a DOM element from elsewhere in your program, you can look up the scores, types, and notes Fathom attached to it:</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">fnode</span> <span class="o">=</span> <span class="nx">facts</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">dom</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;aTitle&#39;</span><span class="p">));</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>A DOM subtree can be passed in instead, if you like:</p>
<div class="last highlight-js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">subtreeFacts</span> <span class="o">=</span> <span class="nx">rules</span><span class="p">.</span><span class="nx">against</span><span class="p">(</span><span class="nx">dom</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstElementChild</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ruleset.html" class="btn btn-neutral float-right" title="Rule and Ruleset Reference" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="intro.html" class="btn btn-neutral" title="Introduction" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Mozilla Foundation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>